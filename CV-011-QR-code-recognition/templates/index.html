<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤ ‚Äî CV-011</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #333; }
        .upload-area {
            border: 3px dashed #ccc;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
        }
        .preview, .result { margin-top: 20px; }
        img { max-width: 100%; border: 1px solid #ddd; }
        .data { font-size: 1.2em; font-weight: bold; color: #0066cc; }
        .download-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 20px;
            background: #0066cc;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
        }
        .download-btn:hover { background: #0055aa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤</h1>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å QR-–∫–æ–¥–æ–º, –∏ –º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–µ–º –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ!</p>
        
        <div class="upload-area" onclick="document.getElementById('file-input').click()">
            <p>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
            <input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleFile(this.files)">
        </div>

        <div class="preview" id="preview"></div>
        <div class="result" id="result"></div>
    </div>

    <script>
        function handleFile(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('preview').innerHTML = `
                    <div style="margin: 20px 0;">
                        <p><strong>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ:</strong></p>
                        <img src="${e.target.result}" alt="Preview" style="max-width: 300px; border: 1px solid #ddd;" />
                    </div>
                `;
            };
            reader.readAsDataURL(file);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            document.getElementById('result').innerHTML = `
                <div style="margin: 20px 0;">
                    <p>–ò–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞...</p>
                    <div style="width: 100%; background: #f0f0f0; border-radius: 4px;">
                        <div id="progress-bar" style="width: 0%; height: 20px; background: #0066cc; border-radius: 4px; transition: width 0.3s;"></div>
                    </div>
                </div>
            `;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            let width = 0;
            const progressBar = document.getElementById('progress-bar');
            const timer = setInterval(() => {
                if (width >= 100) {
                    width = 0;
                }
                width += 10;
                progressBar.style.width = width + '%';
            }, 300);
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                clearInterval(timer);
                progressBar.style.width = '100%';
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('result').innerHTML = `<p style="color: red">–û—à–∏–±–∫–∞: ${data.error}</p>`;
                    return;
                }
                
                document.getElementById('result').innerHTML = `
                    <p class="data">–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${data.data}</p>
                    <img src="data:image/jpeg;base64,${data.image}" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è">
                    <a href="data:image/jpeg;base64,${data.image}" class="download-btn" download="qr_result.jpg">–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</a>
                `;
            })
            .catch(error => {
                clearInterval(timer);
                progressBar.style.width = '100%';
                document.getElementById('result').innerHTML = 
                    `<p style="color: red">
                        –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. <br>
                        1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: <code>python qr_web_app.py</code><br>
                        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 5000 —Å–≤–æ–±–æ–¥–µ–Ω<br>
                        3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞
                    </p>`;
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
# Troubleshooting

## Распространенные проблемы

### Файл каскада Хаара не найден

**Симптомы:**
```
FileNotFoundError: Файл каскада не найден по путям: [...]
```

**Решение:**
1. Убедитесь, что файл `haarcascade_frontalface_default.xml` находится в папке `configs/`
2. Проверьте правильность пути в коде:
   ```python
   self.cascade_path = os.path.join(os.path.dirname(__file__), '..', 'configs', 'haarcascade_frontalface_default.xml')
   ```
3. Если файла нет, скачайте его из официального репозитория OpenCV:
   [haarcascade_frontalface_default.xml](https://github.com/opencv/opencv/blob/master/data/haarcascades/haarcascade_frontalface_default.xml)
4. Поместите файл в `CV-010_face_detection/configs/`

### Изображение не загружается

**Симптомы:**
```
ValueError: Не удалось загрузить изображение
```

**Решение:**
1. Проверьте, что файл изображения существует по указанному пути
2. Убедитесь, что формат изображения поддерживается OpenCV (JPG, PNG, BMP и др.)
3. Проверьте права доступа к файлу
4. Убедитесь, что файл не поврежден

### Порт 5000 уже используется

**Симптомы:**
```
OSError: [Errno 98] Address already in use
```

**Решение:**

**Вариант 1: Завершить процесс, использующий порт**
```bash
# Найти процесс, использующий порт 5000
netstat -aon | findstr ":5000"

# Завершить процесс по PID
taskkill /PID <PID> /F
```

**Вариант 2: Использовать другой порт**
Измените порт в `src/CV-010-app.py`:
```python
if __name__ == '__main__':
    app.run(debug=True, port=8080, use_reloader=False)  # Измените 5000 на 8080
```

### Нет обнаруженных лиц

**Симптомы:**
```
INFO - ✅ Найдено 0 лиц
```

**Решение:**
1. Проверьте, что на изображении действительно есть лица
2. Попробуйте изменить параметры детекции в `face_detection_core.py`:
   ```python
   self.config.scale_factor = 1.05  # Меньше значение для большей точности
   self.config.min_neighbors = 3     # Меньше значение для более чувствительной детекции
   self.config.min_size = (20, 20)   # Меньший минимальный размер лица
   ```
3. Убедитесь, что лица на изображении хорошо освещены и видны фронтально
4. Попробуйте другое изображение для тестирования

### Ошибки при установке зависимостей

**Симптомы:**
```
ERROR: Could not find a version that satisfies the requirement ...
```

**Решение:**

**Вариант 1: Использовать conda вместо pip**
```bash
conda install -c conda-forge opencv
conda install numpy flask
```

**Вариант 2: Обновить pip**
```bash
python -m pip install --upgrade pip
pip install -r requirements.txt
```

**Вариант 3: Создать новое виртуальное окружение**
```bash
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```

## Проблемы с веб-интерфейсом

### Изображение не отображается после загрузки

**Решение:**
1. Проверьте, что папка `static/` существует
2. Убедитесь, что у веб-сервера есть права на запись в папку `static/`
3. Проверьте консоль на наличие ошибок

### Ошибка при кодировании изображения

**Симптомы:**
```
NameError: name 'base64' is not defined
```

**Решение:**
Добавьте импорт в начало файла `face_detection_core.py`:
```python
import base64
```

## Производительность

### Медленная обработка больших изображений

**Решение:**
1. Уменьшите размер изображения перед обработкой
2. Увеличьте `scale_factor` для ускорения обработки (но это может снизить точность)
3. Уменьшите `min_neighbors` для ускорения обработки

### Высокое потребление памяти

**Решение:**
1. Обрабатывайте изображения по одному
2. Удаляйте временные файлы после обработки
3. Используйте `del` для удаления переменных с большими изображениями после использования

## Отладка

### Включение подробного логгирования

Добавьте в начало скрипта для более подробного вывода:
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### Проверка версии OpenCV

Для диагностики проблем с OpenCV проверьте версию:
```python
import cv2
print(cv2.__version__)
```
